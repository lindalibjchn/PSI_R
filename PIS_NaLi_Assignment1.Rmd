---
title: "PSI_Assignment 1: Digital Portfolio"
author: Na Li (D19125334)
output: html_document
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE)

needed_packages <- c("VIM", "tidyverse","pastecs", "ggplot2", "semTools", "psych", "FSA", "car", "effectsize", "coin", "rstatix", "sjstats", "userfriendlyscience", "stats", "foreign", "gmodels")   
# Extract not installed packages
not_installed <- needed_packages[!(needed_packages %in% installed.packages()[, "Package"])]    
# Install not installed packages
if(length(not_installed)) install.packages(not_installed) 

library(pastecs) #For creating descriptive statistic summaries
library(ggplot2) #For creating histograms with more detail than plot
library(semTools) #For skewness and kurtosis
library(psych)  #For descriptive functions
library(FSA) #For percentage
library(car) # For Levene's test for homogeneity of variance 
library(effectsize) #To calculate effect size for t-test
library(VIM)
library(tidyverse)
library(coin) # For Wilcox test (non-parametric)
library(rstatix) # For calculating effect size
library(sjstats) #calculate effect size for t-test
library(userfriendlyscience)
library(stats)
library(foreign) # open SPSS file, I may not use that.
library(gmodels) #For creating histograms with more detail than plot
```

# Understanding Dataset

This dataset is Secondary School student Performance in secondary education of two Portuguese schools, in this secion, 
1. Merged data set from two csv files (student-mat.csv (Math course) and student-por.csv (Portuguese language course) datasets), account the number of data set as a sample data. 
2. Visualising Quantitative Data
3. Visualising Qualitative Data

```{r initial dataset, echo=TRUE}
getwd()

stdMathData=read.table("student-mat.csv",sep=";",header=TRUE) #read student 
stdPorlagData=read.table("student-por.csv",sep=";",header=TRUE)

colnames(stdMathData) <- tolower(colnames(stdMathData))
#number of students math course -> 395 records
nrow(stdMathData)
colnames(stdPorlagData) <- tolower(colnames(stdPorlagData))
#number of students for Portuguese language course -> 649 records
nrow(stdPorlagData)

stdMergeData=merge(d1,d2,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))
#total number of the dataset
print(nrow(stdMergeData)) # 382 records/rows/cases

colnames(stdMergeData) <- tolower(colnames(stdMergeData))

write.csv(x=stdMergeData, file="student_merged.csv")

#show variables in three datasets
colnames(stdMathData)
colnames(stdPorlagData)
colnames(stdMergeData)

```
## Qualitative Data
```{r descripting sample}
# Looking at interest variables in two Samples: sex, mother jobs, father job, reason
# Qualitative data 

stdMathData$sex <- as.factor(stdMathData$sex)
stdPorlagData$sex <- as.factor(stdPorlagData$sex)
stdMergeData$sex <- as.factor(stdMergeData$sex)

summary(stdMathData$sex)
summary(stdPorlagData$sex)
summary(stdMergeData$sex)

```
```{r descripting sample}
# Looking at interest variables in two Samples: sex, mother jobs, father job, reason
# Qualitative data 

stdMathData$mjob <- as.factor(stdMathData$mjob)
stdPorlagData$mjob <- as.factor(stdPorlagData$mjob)

summary(stdMathData$mjob)
summary(stdPorlagData$mjob)
```
```{r descripting sample}
# Looking at interest variables in two Samples: sex, mother jobs, father job, reason
# Qualitative dataset 
stdMathData$fjob <- as.factor(stdMathData$fjob)
stdPorlagData$fjob <- as.factor(stdPorlagData$fjob)

summary(stdMathData$fjob)
summary(stdPorlagData$fjob)
```
```{r descripting sample}
# Looking at interest variables in two Samples: address
# Qualitative data 
stdMathData$address <- as.factor(stdMathData$address)
stdPorlagData$address <- as.factor(stdPorlagData$address)
# Student data for Math course: reason to choose this school 
summary(stdMathData$address)
```
``` {r descripting sample}
# Student data for Portuguese language course: reason to choose this school 
summary(stdPorlagData$address)
```
``` {r descripting sample}
# Looking at interest variables in two Samples: family educational support 
# Qualitative data 
stdMathData$famsup <- as.factor(stdMathData$famsup)
stdPorlagData$famsup <- as.factor(stdPorlagData$famsup)
# Math course
str(stdMathData$famsup)
summary(stdMathData$famsup)
```
``` {r descripting sample}
# Looking at interest variables in two Samples: family educational support 
# Qualitative data 
# Portuguese language course
str(stdPorlagData$famsup)
summary(stdPorlagData$famsup)
```
``` {r descripting sample}
# Looking at interest variables in two Samples: with a romantic relationship 
# Qualitative data 
stdMathData$romantic <- as.factor(stdMathData$romantic)
stdPorlagData$romantic <- as.factor(stdPorlagData$romantic)
# Math course
str(stdMathData$romantic)
summary(stdMathData$romantic)
```

``` {r descripting sample}
# Looking at interest variables in two Samples: with a romantic relationship 
# Qualitative data 
# Portuguese language course
str(stdPorlagData$romantic)
summary(stdPorlagData$romantic)
```
## Quantitative Data
Looking at interest quantitativ data of variables in two samples: traveltime, studytime, G1 - G3 (grade 1 to grade 3),
### Measure of Central Tendency:mean, median, mode, 
```{r descripting sample: mean}
#traveltime: math course
mean(stdMathData$traveltime)
#traeltime: portuguese language course
mean(stdPorlagData$traveltime) 
```
```{r descripting sample: median}
#traveltime: math course
median(stdMathData$traveltime)
#traeltime: portuguese language course
median(stdPorlagData$traveltime) 
```

```{r descripting sample: mode}
#traveltime: math course
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

getmode(stdMathData$traveltime)
#traeltime: portuguese language course
getmode(stdPorlagData$traveltime) 
``` 
```{r descripting sample: traveltime}
#traveltime: math course
summary(stdMathData$traveltime)
#traeltime: portuguese language course
summary(stdPorlagData$traveltime)
``` 
```{r descripting sample: studytime}
#studytime: math course
summary(stdMathData$studytime)
#studytime: portuguese language course
summary(stdPorlagData$studytime)
``` 
```{r descripting sample: mode}
#studytime: math course
getmode(stdMathData$studytime)
#studytime: portuguese language course
getmode(stdPorlagData$studytime) 
```

```{r descripting sample: g1}
#studytime: math course
summary(stdMathData$g1)
#studytime: portuguese language course
summary(stdPorlagData$g1)
``` 

```{r descripting sample: mode}
#G1: math course
getmode(stdMathData$g1)
#G1: portuguese language course
getmode(stdPorlagData$g1) 
```

```{r descripting sample: g2}
#studytime: math course
summary(stdMathData$g2)
#studytime: portuguese language course
summary(stdPorlagData$g2)
``` 

```{r descripting sample: mode}
#G2: math course
getmode(stdMathData$g2)
#G2: portuguese language course
getmode(stdPorlagData$g2) 
```

```{r descripting sample: g3}
#studytime: math course
summary(stdMathData$g3)
#studytime: portuguese language course
summary(stdPorlagData$g3)
``` 

```{r descripting sample: mode}
#G3: math course
getmode(stdMathData$g3)
#G3: portuguese language course
getmode(stdPorlagData$g3) 
```
### Measure of Dispersion (descriptive statistics): range, quantiles, standard deviation (sd), IQR
```{r descripting sample: SD}
#G1: math course
round(sd(as.double(stdMathData$g1)),2)
#G1: portuguese language course
round(sd(as.double(stdPorlagData$g1)),2)
```
```{r descripting sample: SD}
#G2: math course
round(sd(as.double(stdMathData$g2)),2)
#G2: portuguese language course
round(sd(as.double(stdPorlagData$g2)),2)
```
```{r descripting sample: SD}
#G3: math course
sdMathData_g3 <- sd(as.double(stdMathData$g3))
round(sdMathData_g3, 2)
#G3: portuguese language course
sdPorlagData_g3 <- sd(as.double(stdPorlagData$g3))
round(sdPorlagData_g3,2)

```

```{r descripting sample: range, quantile and Interquartile Range}
#math course
range(as.double(stdMathData$g1))
quantile(as.double(stdMathData$g1))
IQR(as.double(stdMathData$g1))
var(as.double(stdMathData$g1))
 
#portuguese language course
range(as.double(stdPorlagData$g1))
quantile(as.double(stdPorlagData$g1))
IQR(as.double(stdPorlagData$g1))
var(as.double(stdPorlagData$g1))
```
```{r descripting sample: range, quantile and Interquartile Range}
#math course
range(as.double(stdMathData$g2))
quantile(as.double(stdMathData$g2))
IQR(as.double(stdMathData$g2))
var(as.double(stdMathData$g2))
 
#portuguese language course
range(as.double(stdPorlagData$g2))
quantile(as.double(stdPorlagData$g2))
IQR(as.double(stdPorlagData$g2))
var(as.double(stdPorlagData$g2))
```
```{r descripting sample: range, quantile and Interquartile Range}
#math course
range(as.double(stdMathData$g3))
quantile(as.double(stdMathData$g3))
IQR(as.double(stdMathData$g3))
var(as.double(stdMathData$g3))
 
#Portuguese language course
range(as.double(stdPorlagData$g3))
quantile(as.double(stdPorlagData$g3))
IQR(as.double(stdPorlagData$g3))
var(as.double(stdPorlagData$g3))
```
### Visuallsing Quantitative Data
```{r plot G3 echo=FALSE}

gg_g3 <- ggplot(stdMathData, aes(x=stdMathData$g3))
gg_g3 <- gg_g3 + labs(x="G3")
gg_g3 <- gg_g3 + geom_histogram(bins = 30,aes(y=..density.., color=sex, fill=..count..)) 
   #geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
       
  
#gg_g3 <- gg_g3 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g3 <- gg_g3 + stat_function(fun=dnorm, color='red',args=list(mean=mean(stdMathData$g3, na.rm=TRUE), sd=sd(stdMathData$g3, na.rm=TRUE)))

gg_g3

```

```{r plot absences echo=FALSE}

ggplot(stdMathData, aes(x=stdMathData$absences)) + 
         labs(x="math: absences") +
         geom_histogram(bins = 30,aes(y=..density.., fill=..count..)) +
         stat_function(fun=dnorm, color='red',args=list(mean=mean(stdMathData$absences, na.rm=TRUE), sd=sd(stdMathData$absences, na.rm=TRUE)))

```
```{r plot absences echo=FALSE}

gg_st <- ggplot(stdPorlagData, aes(x=stdPorlagData$absences))
gg_st <- gg_st + labs(x="Portuguese language: absences")
gg_st <- gg_st + geom_histogram(bins = 30,aes(y=..density.., fill=..count..)) 
gg_st <- gg_st + stat_function(fun=dnorm, color='red',args=list(mean=mean(stdPorlagData$absences, na.rm=TRUE), sd=sd(stdPorlagData$absences, na.rm=TRUE)))

gg_st

```

```{r plot studytime echo=FALSE}
#pie chart
mytable <- table(stdMathData$studytime)
lbls <- paste(names(mytable), "\n", mytable, sep="")
pie(mytable, labels = lbls,
   main="Math: Weekly Study time \n 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours")

# Pie Chart from data frame with Appended Sample Sizes
mytable_por <- table(stdPorlagData$studytime)
lbls <- paste(names(mytable_por), "\n", mytable_por, sep="")
pie(mytable, labels = lbls,
   main="Prtuguese language: Weekly Study time \n 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours")
```

```{r plot echo=FALSE}
gg_math <- ggplot(stdMathData, aes(x=stdMathData$g1))
gg_math <- gg_math + labs(x="Math:G1-Red, G2-Blue, G3-Green", y="Frequency")
gg_math <- gg_math + stat_function(fun=dnorm, color='red',args=list(mean=mean(stdMathData$g1, na.rm=TRUE), sd=sd(stdMathData$g1, na.rm=TRUE)))

gg_math <- gg_math + stat_function(fun=dnorm, color='blue',args=list(mean=mean(stdMathData$g2, na.rm=TRUE), sd=sd(stdMathData$g2, na.rm=TRUE)))


gg_math <- gg_math + stat_function(fun=dnorm, color='green',args=list(mean=mean(stdMathData$g3, na.rm=TRUE), sd=sd(stdMathData$g3, na.rm=TRUE)))

gg_math

```
```{r}
gg_porlag <- ggplot(stdPorlagData, aes(x=stdPorlagData$g1))
gg_porlag <- gg_porlag + labs(x="Portuguese language:G1-Red, G2-Blue, G3-Green", y="Frequency")
gg_porlag <- gg_porlag + stat_function(fun=dnorm, color='red',args=list(mean=mean(stdPorlagData$g1, na.rm=TRUE), sd=sd(stdPorlagData$g1, na.rm=TRUE)))

gg_porlag <- gg_porlag + stat_function(fun=dnorm, color='blue',args=list(mean=mean(stdPorlagData$g2, na.rm=TRUE), sd=sd(stdPorlagData$g2, na.rm=TRUE)))


gg_porlag <- gg_porlag + stat_function(fun=dnorm, color='green',args=list(mean=mean(stdPorlagData$g3, na.rm=TRUE), sd=sd(stdPorlagData$g3, na.rm=TRUE)))

gg_porlag

```

```{r plot G1 echo=FALSE}

female <- filter(stdMathData, sex == "F")
male <- filter(stdMathData, sex=="M")

gg_g1 <- ggplot(stdMathData, aes(x=g1, fill=sex, colour=sex)) + geom_density(alpha = 0.1)
gg_g1 <- gg_g1 + labs(x="Math:Normality G1")

gg_g1 <- gg_g1 + stat_function(data = female, geom = "point", fun=dnorm, args=list(mean=mean(female$g1, na.rm=TRUE), sd=sd(female$g1, na.rm=TRUE)))

gg_g1 <- gg_g1 + stat_function(data = male, geom = "point", fun=dnorm, args=list(mean=mean(male$g1, na.rm=TRUE), sd=sd(male$g1, na.rm=TRUE)))

gg_g1

```
```{r plot G1 echo=FALSE}
library(ggplot2)

female <- filter(stdPorlagData, stdPorlagData$sex=="F")
male <- filter(stdPorlagData, stdPorlagData$sex=="M")

gg_g1 <- ggplot(stdPorlagData, aes(x=g1, fill=sex, colour=sex)) + geom_density(alpha = 0.1)
gg_g1 <- gg_g1 + labs(x="Portuguese language: Normality G1")

gg_g1 <- gg_g1 + stat_function(data = female, geom = "point", fun=dnorm, args=list(mean=mean(female$g1, na.rm=TRUE), sd=sd(female$g1, na.rm=TRUE)))

gg_g1 <- gg_g1 + stat_function(data = male, geom = "point", n=200, fun=dnorm, args=list(mean=mean(male$g1, na.rm=TRUE), sd=sd(male$g1, na.rm=TRUE)))

gg_g1

```

```{r plot G3 echo=FALSE}
#qq-plot
qqnorm(stdMathData$g3)
qqline(stdMathData$g3, col=2)
```

```{r statistic summary G3}
library(pastecs)
pastecs::stat.desc(stdMathData$g3, basic=F)
``` 
```{r}
tpskew<-semTools::skew(stdMathData$g3)
tpkurt<-semTools::kurtosis(stdMathData$g3)
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]
```
```{r}
ztpcoiss<- abs(scale(stdMathData$g3))
FSA::perc(as.numeric(ztpcoiss), 1.96, "gt")
```
```{r}
FSA::perc(as.numeric(ztpcoiss), 3.29, "gt")
```

```{r plot G2 echo=FALSE}
gg_g2 <- ggplot(stdMathData, aes(x=stdMathData$g2))
gg_g2 <- gg_g2 + labs(x="G2")
gg_g2 <- gg_g2 + geom_histogram(bins = 30,aes(y=..density.., fill=..count..,color=stdMathData$sex))
#gg_g2 <- gg_g2 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g2 <- gg_g2 + stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathData$g2, na.rm=TRUE), sd=sd(stdMathData$g2, na.rm=TRUE)))

gg_g2

```

```{r plot G1 echo=FALSE}
gg_g1 <- ggplot(stdMathData, aes(x=g1))
gg_g1 <- gg_g1 + labs(x="G1: Math")
gg_g1 <- gg_g1 + geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
gg_g1 <- gg_g1 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g1 <- gg_g1 + stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathData$g1, na.rm=TRUE), sd=sd(stdMathData$g1, na.rm=TRUE)))

gg_g1
```

``` {r}
library(ggplot2)
gg_g1 <- ggplot(stdMathData, aes(x=stdMathData$g1))
gg_g1 <- gg_g1 + labs(x="G1: Math")
gg_g1 <- gg_g1 + geom_histogram(bins = 30,aes(y=..density.., color=sex, fill=..count..)) 
   #geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
       
  
#gg_g3 <- gg_g3 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g1 <- gg_g1 + stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathData$g1, na.rm=TRUE), sd=sd(stdMathData$g1, na.rm=TRUE)))

gg_g1
```
```{r plot G1 echo=FALSE}
gg_g1 <- ggplot(stdPorlagData, aes(x=g1))
gg_g1 <- gg_g1 + labs(x="G1: Portuguese language")
gg_g1 <- gg_g1 + geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
gg_g1 <- gg_g1 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g1 <- gg_g1 + stat_function(fun=dnorm, color="red",args=list(mean=mean(stdPorlagData$g1, na.rm=TRUE), sd=sd(stdPorlagData$g1, na.rm=TRUE)))

gg_g1
```

``` {r}
library(ggplot2)
gg_g1 <- ggplot(stdPorlagData, aes(x=stdPorlagData$g1))
gg_g1 <- gg_g1 + labs(x="G1: Portuguese language")
gg_g1 <- gg_g1 + geom_histogram(bins = 30,aes(y=..density.., color=sex, fill=..count..)) 
   #geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
#gg_g3 <- gg_g3 + scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C")

gg_g1 <- gg_g1 + stat_function(fun=dnorm, color="red",args=list(mean=mean(stdPorlagData$g1, na.rm=TRUE), sd=sd(stdPorlagData$g1, na.rm=TRUE)))

gg_g1
```
### Missing Data
```{r exploring missing data}
variableint <- c("g1", "g2", "g3", "studytime", "traveltime", "health", "absences", "famrel", "freetime")
subdata_math <-stdMathData[variableint]
subdata_por <- stdPorlagData[variableint]
summary(subdata_math)
summary(subdata_por)
```

```{r show missing data: math course}
#Create and inspect patterns of missingness
res_math<-summary(VIM::aggr(subdata_math, sortVar=TRUE))$combinations

#Output the most common combinations
head(res_math[rev(order(res_math[,2])),])
```

```{r show missing data: Portuguese language course}
#Create and inspect patterns of missingness
res_portuggese<-summary(VIM::aggr(subdata_por, sortVar=TRUE))$combinations

#Output the most common combinations
head(res_portuggese[rev(order(res_portuggese[,2])),])
```
The results show that the variables of interests, no missing data.
 

# Explore Data
## descriptive statistics
```{r Generate Summary Statistics}
# Center Tendency
variableint <- c("g1", "g2", "studytime", "traveltime","absences")
subdata_math <-stdMathData[variableint]
subdata_por <- stdPorlagData[variableint]
summary(subdata_math)
summary(subdata_por)

## summary variability 
pastecs::stat.desc(stdMathData[variableint], basic=F)
pastecs::stat.desc(stdPorlagData[variableint], basic=F)
```


## Assessing a variable for Normality
Step 1: Assessing by plots
Histogram with normal curve 
QQ-plot checking if it can be normalised 
Step 2:  Summary Statistics including measure of skewness and kurtosis. 
Step 3: Review statistics by plotting to check whether it close to normal data. 
Step 4: Report correct statistics depend on the assessment and show the result whether the data can follow the normal distribution.

``` {r normality}
# histogram for math course sample

#study time
histogr_stdtime <- ggplot(stdMathData, aes(x=studytime)) + 
                   labs(x="Weekly Study Time for Math Course") + 
                   geom_histogram(bins=8, colour="blue", aes(y= ..density.., fill=..count..)) +
                   scale_fill_gradient("count", low="#132B43", high="#56B1F7") +
                   stat_function(fun=dnorm, color="red", args=list(mean=mean(stdMathData$studytime, na.rm=TRUE), sd=sd(stdMathData$studytime, na.rm=TRUE)))

histogr_stdtime
boxplot(stdMathData$studytime,
        main = "Math course: Weekly Study Time",
        col = "orange",
        border = "brown",
        horizontal = TRUE)

# absences
histogr_ab <- ggplot(stdMathData, aes(x=absences)) + 
                   labs(x="The number of absences for Math Course") + 
                   geom_histogram(bins=25, colour="blue", aes(y= ..density.., fill=..count..)) +
                   scale_fill_gradient("count", low="#132B43", high="#56B1F7") +
                   stat_function(fun=dnorm, color="red", args=list(mean=mean(stdMathData$absences, na.rm=TRUE), sd=sd(stdMathData$absences, na.rm=TRUE)))
histogr_ab
boxplot(stdMathData$absences,
        main = "Math course: Absences",
        #xlab = "Number of absences",
        col = "orange",
        border = "brown",
        horizontal = TRUE)

#g1
histogr_g1 <- ggplot(stdMathData, aes(x=g1)) + 
                   labs(x="The first period grade for math course") + 
                   geom_histogram(bins=30, colour="blue", aes(y= ..density.., fill=..count..)) +
                   scale_fill_gradient("count", low="#132B43", high="#56B1F7") +
                   stat_function(fun=dnorm, color="red", args=list(mean=mean(stdMathData$g1, na.rm=TRUE), sd=sd(stdMathData$g1, na.rm=TRUE)))
histogr_g1
boxplot(stdMathData$g1,
        main = "Math course: G1",
        col = "orange",
        border = "brown",
        horizontal = TRUE)

#g2
histogr_g2 <- ggplot(stdMathData, aes(x=g2)) + 
                   labs(x="The second period grade for math course") + 
                   geom_histogram(bins=30, colour="blue", aes(y= ..density.., fill=..count..)) +
                   scale_fill_gradient("count", low="#132B43", high="#56B1F7") +
                   stat_function(fun=dnorm, color="red", args=list(mean=mean(stdMathData$g1, na.rm=TRUE), sd=sd(stdMathData$g1, na.rm=TRUE)))
histogr_g2
boxplot(stdMathData$g1,
        main = "Math course: G2",
        col = "orange",
        border = "brown",
        horizontal = TRUE)

```
```{r normality}
#create qq-plot for g1
qqnorm(stdMathData$g1, xlab = "Math course: G1")
qqline(stdMathData$g1, col=2)

qqnorm(stdMathData$g2, xlab="Math course: G2")
qqline(stdMathData$g2, col=2)

qqnorm(stdMathData$absences, xlab="Math course: Number of Absences")
qqline(stdMathData$absences, col=2)

qqnorm(stdMathData$studytime, xlab="Math course: Weekly Study time")
qqline(stdMathData$studytime, col=2)
```
```{r normality}
#g1 generae summary statistics
pastecs::stat.desc(stdMathData$g1, basic=F)

#skewness and kurtosis
tpskew <- semTools::skew(stdMathData$g1)
tpkurt <- semTools::kurtosis(stdMathData$g1)

tpskew
tpkurt

tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]

mathg1<- abs(scale(stdMathData$g1))
FSA::perc(as.numeric(mathg1), 1.96, "gt")
FSA::perc(as.numeric(mathg1), 3.29, "gt")
```

```{r normality}
#g2 generae summary statistics
pastecs::stat.desc(stdMathData$g2, basic=F)

#skewness and kurtosis
tpskew <- semTools::skew(stdMathData$g2)
tpkurt <- semTools::kurtosis(stdMathData$g2)

tpskew
tpkurt

tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]

mathg1<- abs(scale(stdMathData$g2))
FSA::perc(as.numeric(mathg1), 1.96, "gt")
FSA::perc(as.numeric(mathg1), 3.29, "gt")
```

```{r normality}
#study time generae summary statistics
pastecs::stat.desc(stdMathData$studytime, basic=F)

#skewness and kurtosis
tpskew <- semTools::skew(stdMathData$studytime)

tpkurt <- semTools::kurtosis(stdMathData$studytime)

tpskew
tpkurt
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]

mathst<- abs(scale(stdMathData$studytime))
FSA::perc(as.numeric(mathst), 1.96, "gt") #greater >= 1.96
FSA::perc(as.numeric(mathst), 3.29, "gt") #greater >= 3.29
```

```{r normality}
#absences generae summary statistics
pastecs::stat.desc(stdMathData$absences, basic=F)

#skewness and kurtosis
tpskew <- semTools::skew(stdMathData$absences)
tpkurt <- semTools::kurtosis(stdMathData$absences)

#tpskew
#tpkurt

tpskew[1]/tpskew[2]

tpkurt[1]/tpkurt[2]

mathg1<- abs(scale(stdMathData$absences))

#calculate the percentage that are greater than 1.96
FSA::perc(as.numeric(mathg1), 1.96, "gt")
# calculate the percentage that are greater than 3.29
FSA::perc(as.numeric(mathg1), 3.29, "gt")
```

## Correlation

### 1. The correlation between number of absences (absences) and the first period grade (g1)
```{r scatterplot}
#show scatterplot of the number of absences and the first period grade

scat_g1 <- ggplot(stdMathData, aes(stdMathData$absences,stdMathData$g1)) +
#show regression line
       geom_point() +
       geom_smooth(method="lm", colour="red", se = F) +
       labs(x = "The Number of Absences", y = "First Period Grade for Math course")
scat_g1
```

```{r pearson}
# Conducting Correlation Tests - Pearson, Spearman, Kendall
# Pearson corrlection test --- Parametric test
# Pearson Correlation  (Parametric)
# Spearman Rank Order Correlation or Kendall’s Tau (Non-Parametric)

#1. Pearson corrlation
stats::cor.test(stdMathData$g1,stdMathData$absences, method='pearson')
```

```{r spearman}
#2. Spearman corrleation to check the missing data if the data does not fit a normal distribution, then we can use spearman or kurtosis
stats::cor.test(stdMathData$g1, stdMathData$absences, method='spearman')
```

```{r kendall}
#3. kendall which handle ties
stats::cor.test(stdMathData$g1, stdMathData$absences, method='kendall')
```

### 2. The correlation between weekly study time (x) and the first period grade (g1) (y)
```{r scatterplot}
#show scatterplot of the number of studytime and the first period grade
scat_st <- ggplot(stdMathData, aes(stdMathData$studytime,stdMathData$g1)) +
#show regression line
       geom_point() +
       geom_smooth(method="lm", colour="red", se = F) +
       labs(x = "Weekly Study time for Math course", y = "First Period Grade for Math course")
scat_st
``` 

```{r studytime}
# Conducting Correlation Tests - Pearson, Spearman, Kendall
# Pearson corrlection test --- Parametric test
# Pearson Correlation  (Parametric)
# Spearman Rank Order Correlation or Kendall’s Tau (Non-Parametric)

#1. Pearson corrlation
stats::cor.test(stdMathData$g1,stdMathData$studytime, method='pearson')
```

```{r spearman}
#2. Spearman corrleation to check the missing data if the data does not fit a normal distribution, then we can use spearman or kurtosis
stats::cor.test(stdMathData$g1, stdMathData$studytime, method='spearman')
```

```{r kendall}
#3. kendall which handle ties
stats::cor.test(stdMathData$g1, stdMathData$studytime,method='kendall')
```
### 3. The correlation between second period grade (g2)  (y) and the first period grade (g1) (x)
```{r scatterplot}
#show scatterplot of second period grade (g2)  (y) and the first period grade (g1) (x)

scat_g2 <- ggplot(stdMathData, aes(stdMathData$g1, stdMathData$g2)) +
#show regression line
       geom_point() +
       geom_smooth(method="lm", colour="red", se = F) +
       labs(x = "First Period Grade for Math course", y = "Second Period Grade for Math course")
scat_g2
```

```{r pearson}
# Conducting Correlation Tests - Pearson, Spearman, Kendall
# Pearson corrlection test --- Parametric test
# Pearson Correlation  (Parametric)
# Spearman Rank Order Correlation or Kendall’s Tau (Non-Parametric)

#1. Pearson corrlation
stats::cor.test(stdMathData$g2, stdMathData$g1, method='pearson')
```

```{r spearman}
#2. Spearman corrleation to check the missing data if the data does not fit a normal distribution, then we can use spearman or kurtosis
stats::cor.test(stdMathData$g2, stdMathData$g1, method='spearman')
```

```{r kendall}
#3. kendall which handle ties
stats::cor.test(stdMathData$g2, stdMathData$g1, method='kendall')
```



# Analyse
## Difference for parametic/non-parametic
### Parametic test (independent t-test/levene's test)
1. absences -- by internet 
```{r 1. absences by internet }
# the variable: the number of absences has generated histogram and summary statistics in th "Explore Data"
# describle the number of absences by internet group
# internet: Internet access at home (binary: yes or no)

# number of absences has been generated histogram and summary statistics in th "Explore Data"
# get descriptive statistics by internet group
psych::describeBy(stdMathData$absences, stdMathData$internet, mat=TRUE)

```
``` {r levenTest and t-test}
# Levene's test for homogenity of variable 
car::leveneTest(absences ~ internet, data=stdMathData)

# Conduct the t-test
# var.equal = True is to specify equal variances and a pooled variance estimate.
res <- stats::t.test(absences ~ internet, var.equal=TRUE, data=stdMathData)
res
```
```{r effect size check: Cohen's d and Eta}
# statistically significant difference was found
#Cohen's d
# Reporting guideline: Cohen’s d
#0.2=small effect, 0.5=moderate, 0.8 = large

effsize = round((2 * res$statistic)/sqrt(res$parameter), 2)

#using function from effectize package
effectsize::t_to_d(t=res$statistic, res$parameter)
```

```{r effect size check: Eta}
# statistically significant difference was found
# Eta
# reporting guideline: on effect size: 0.01 = small, 0.06 = moderate, 0.14 =large
effes=round((res$statistic*res$statistic)/((res$statistic*res$statistic)+(res$parameter)),3)

effes
```

Report this t-test result:
```
1. Reporting the results with Cohen’s d effect
An independent-samples t-test was conducted to compare the number of absences of Math course for students who have internet at home and those who do not have internet at home. There is a slight Significant difference in the scores for absences was found (M=6.07, SD=8.52 for students who have internet at home, M=3.89, SD=4.25 for students who do not have internet at home), t(393)= -2.027, p-value = 0.043). Cohen's d also indicated a small effect size (-0.20). 

2. Reporting the results with eta squared effect
An independent-samples t-test was conducted to compare the number of absences of Math course for students who have internet at home and those who do not have internet at home. There is a slight Significant difference in the scores for absences was found (M=6.07, SD=8.52 for students who have internet at home, M=3.89, SD=4.25 for students who do not have internet at home), t(393)= -2.027, p-value = 0.043). A small effect size was also indicated by the eta squared value (0.01).
```

2. g3 --- by paid (extra paid classes within the course subject(math) (yes/no)
```{r 2. g3 by paid}
# g3 should be generaged histogram and summary statistics 
ggplot(stdMathData, aes(x=g3))+ 
       labs(x="Final grade for Math course (g3)") + 
       geom_histogram(bins=30, colour="black", aes(y=..density.., fill=..count..)) +             scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") + 
       stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathData$g3, na.rm=TRUE), sd=sd(stdMathData$g3, na.rm=TRUE)))
# Q-Q plot
qqnorm(stdMathData$g3)
qqline(stdMathData$g3, col=2)
```
```{r g3 normality}
#g3 generae summary statistics
pastecs::stat.desc(stdMathData$g3, basic=F)

#skewness and kurtosis
tpskew <- semTools::skew(stdMathData$g3)
tpkurt <- semTools::kurtosis(stdMathData$g3)

tpskew
tpkurt

tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]

mathg3<- abs(scale(stdMathData$g3))
FSA::perc(as.numeric(mathg3), 1.96, "gt")
FSA::perc(as.numeric(mathg3), 3.29, "gt")
```

```{r 2. g3 by paid}
# get descriptive statistics by paid group
psych::describeBy(stdMathData$g3, stdMathData$paid, mat=TRUE)
```

``` {r levenTest and t-test}
# Levene's test for homogenity of variable 
car::leveneTest(g3 ~ paid, data=stdMathData)

# Conduct the t-test
# var.equal = True is to specify equal variabnces and a pooled variance extimate.
res_g3 <- stats::t.test(g3 ~ paid, var.equal=TRUE, data=stdMathData)
res_g3
```

```{r effect size check: Cohen's d and Eta}
# statistically significant difference was found
#Cohen's d
# Reporting guideline: Cohen’s d
#0.2=small effect, 0.5=moderate, 0.8 = large

effsize = round((2 * res_g3$statistic)/sqrt(res_g3$parameter), 2)

#using function from effectize package
effectsize::t_to_d(t=res_g3$statistic, res_g3$parameter)
```

```{r effect size check: Eta}
# statistically significant difference was found
# Eta
# reporting guideline: on effect size: 0.01 = small, 0.06 = moderate, 0.14 =large
effes=round((res_g3$statistic*res_g3$statistic)/((res_g3$statistic*res_g3$statistic)+(res_g3$parameter)),3)

effes
```
Report this t-test result:
```
1. Reporting the results with Cohen’s d effect
An independent-samples t-test was conducted to compare the final grade (g3) for students who have extra paid classes within the course math subject and those who do not have extra paid classes within the course math subject. There is a slight Significant difference in the scores for the third period grade was found (M=10.92, SD=3.79 for students who have extra paid classes, M=10.00, SD=5.13 for students who do not have extra paid classes), t(393)= -2.03, p-value < 0.05). Cohen's d also indicated a small effect size (-0.21). 

2. Reporting the results with eta squared effect
An independent-samples t-test was conducted to compare the final grade (g3) for students who have extra paid classes within the course math subject and those who do not have extra paid classes within the course math subject. There is a slight Significant difference in the scores for the third period grade was found (M=10.92, SD=3.79 for students who have extra paid classes, M=10.00, SD=5.13 for students who do not have extra paid classes), t(393)= -2.03, p-value < 0.05). A small effect size was also indicated by the eta squared value (0.01).
```

### Non-Parametric test (Mann-Whitney test)
1. Weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)
```{r discriptive statistics}
# get descriptive statistics by sex group
by(stdMathData$studytime, stdMathData$sex, median)
by(stdMathData$studytime, stdMathData$sex, IQR)
```

```{r plot histogram}

#split dataset by sex
stdMath_F <- subset(stdMathData, sex="F")
stdMath_M <- subset(stdMathData, set="M")

ggplot(stdMath_F, aes(x=studytime)) +
      ggtitle ("Weekly Study time by sex")+ 
      labs(x="Female: studytime") + 
      geom_histogram(bins=4, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_F$studytime,                                                       na.rm=TRUE),sd=sd(stdMath_F$studytime, na.rm=TRUE)))

ggplot(stdMath_M, aes(x=studytime)) +
      ggtitle ("Weekly Study time by sex")+ 
      labs(x="Male: studytime") + 
      geom_histogram(bins=4, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_M$studytime,                                                       na.rm=TRUE),sd=sd(stdMath_M$studytime, na.rm=TRUE)))
```
```{r Mann Whitney U (Wilcoxon Test)}
#test for differences on Gender to get U statistic 
stats::wilcox.test(studytime ~ sex, data = stdMathData)
# calculate z-score
coin::wilcox_test(studytime~as.factor(sex), data=stdMathData)
```
```{r effect size}
wilcoeffsize = rstatix::wilcox_effsize(studytime ~ sex, data=stdMathData)
wilcoeffsize
```

```
Reporting the results for the Mann-Whitney test
The weekly study time by female stdMath_F (Mdn=2.00, IQR=1.00) was significantly more study time than male stdMath_M (Mdn=2.00, IQR=1.00), (U=26434.00, z=6.69, p<.001, r=0.34) for Math course sample. 
```

2. Current health status ((numeric: from 1 - very bad to 5 - very good)) by extra-curricular activities (yes/no)
```{r discriptive statistics}
# get descriptive statistics by extra-curricular activities
by(stdMathData$health, stdMathData$activities, median)
by(stdMathData$health, stdMathData$activities, IQR)
```

```{r plot histogram}

#split dataset by activities
stdMathHealAct_N <- subset(stdMathData, activities="no")
stdMathHealAct_Y <- subset(stdMathData, activities="yes")

ggplot(stdMathHealAct_Y, aes(x=health)) +
      ggtitle ("Current health status by activities \n (extra-curricular activities)")+ 
      labs(x="Extra-curricular activities: health") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathHealAct_Y$health,                                                       na.rm=TRUE),sd=sd(stdMathHealAct_Y$health, na.rm=TRUE)))

ggplot(stdMathHealAct_N, aes(x=health)) +
      ggtitle("Current health status by nursery \n (attended nursery school)") + 
      labs(x="No extra-curricular activities: health") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMathHealAct_N$health,                                                       na.rm=TRUE),sd=sd(stdMathHealAct_N$health, na.rm=TRUE)))
```
```{r Mann Whitney U (Wilcoxon Test)}
#test for differences on Gender to get U statistic 
stats::wilcox.test(health ~ activities, data = stdMathData)
# calculate z-score
coin::wilcox_test(health~as.factor(activities), data=stdMathData)
```

```{r effect size}
wilcoeffsize = rstatix::wilcox_effsize(health ~ activities, data=stdMathData)
wilcoeffsize
```

```
Reporting the results for the Mann-Whitney test
The current health status for students who do not have extra-curricular activities stdMathHealAct_N (Mdn=4.00, IQR=2.00) did not differ significantly from those who have extra-curricular activities stdMathHealAct_Y (Mdn=4.00, IQR=2.00), (U=18882.00, z=-0.56, p=0.57, r=0.028). 
```


## Repeat measure for difference
### Parametic test (paired t-test)
G1 and G2 and g3 repeat measure 
```{r g1 and g2 repeat measure}

pastecs::stat.desc(stdMathData$g1, basic=F)
pastecs::stat.desc(stdMathData$g2, basic=F)

# paired t-test g1-g2
res_g12 <- t.test(stdMathData$g1, stdMathData$g2, paired=TRUE)
res_g12
```

```{r effect size check: Eta}
# statistically significant difference was found
# Eta
# reporting guideline: on effect size: .01 = small, .06 = moderate, .14 =large
effes=round((res_g12$statistic*res_g12$statistic)/((res_g12$statistic*res_g12$statistic)+(res_g12$parameter)),3)

effes
```

```
Reporting paired t-test between g1 and g2
A paried-samples t-test was conducted to evaluate the impact of the Math course grades between first period grade and second period grade. There was no statistically significant increase in grade scores from the first period grade (M=10.91, SD=3.32) to the second period grade (M=10.71, SD=3.76), (t(394)=1.96, p=0.05). The mean of increase in grade scores was 0.20 with a 95% confidence interval ranging from -0.12e-3 to 0.39. The eta squared statistic (.01) indicated a small effect size.
```

```{r g2 and g3 repeat measure}
pastecs::stat.desc(stdMathData$g2, basic=F)
pastecs::stat.desc(stdMathData$g3, basic=F)

# paired t-test g1-g2
res_g23 <- t.test(stdMathData$g2, stdMathData$g3, paired=TRUE)
res_g23
```

```{r effect size check: Eta}
# statistically significant difference was found
# Eta
# reporting guideline: on effect size: .01 = small, .06 = moderate, .14 =large
effes=round((res_g23$statistic*res_g23$statistic)/((res_g23$statistic*res_g23$statistic)+(res_g23$parameter)),3)

effes
```

```
Reporting paried t-test between g2 and g3
A paired-samples t-test was conducted to evaluate the impact of the Math course grades between second period grade and third period grade. There was statistically significant increase in grade scores from the second period grade (M=10.71, SD=3.76) to the third period grade (M=10.42, SD=4.58), (t(394)=2.99, p=0.003). The mean of increase in grade scores was 0.30 with a 95% confidence interval ranging from 0.10 to 0.50. The eta squared statistic (.022) indicated a small effect size.
```

### Non-Parametic test --- Math course
```{r dalc and walc by sex repeat measure}
# get subset data by sex
variableint <- c("sex", "dalc", "walc")
stdMath_F <- subset(stdMathData, sex=="F")[variableint]
stdMath_M <- subset(stdMathData, sex=="M")[variableint]

# wilcoxon test should both sub samples are the same length
# randomly choose the data in the female sub-samples
#set.seed(2000)
#stdMath_F <- sample_n(stdMath_F, nrow(stdMath_M))

summary(stdMath_F)

summary(stdMath_M)

```

```{r dalc, walc}
# checking if the statistics dalc and walc are non parametic
# Workday alcohol consumption
ggplot(stdMath_F, aes(x=dalc)) +
      ggtitle ("Workday alcohol consumption")+ 
      labs(x="Workday alcohol consumption: Famle") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_F$dalc,                                                       na.rm=TRUE),sd=sd(stdMath_F$dalc, na.rm=TRUE)))

ggplot(stdMath_F, aes(x=walc)) +
      ggtitle ("Weekend alcohol consumption")+ 
      labs(x="Weekend alcohol consumption: Famle") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_F$walc,                                                       na.rm=TRUE),sd=sd(stdMath_F$walc, na.rm=TRUE)))

# Weekend alcohol consumption
ggplot(stdMath_M, aes(x=dalc)) +
      ggtitle ("Workday alcohol consumption")+ 
      labs(x="Workday alcohol consumption: Famle") + 
      geom_histogram(bins=5, colour="blue") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_M$dalc,                                                       na.rm=TRUE),sd=sd(stdMath_M$dalc, na.rm=TRUE)))

ggplot(stdMath_M, aes(x=walc)) +
      ggtitle ("Weekend alcohol consumption")+ 
      labs(x="Weekend alcohol consumption: Male") + 
      geom_histogram(bins=5, colour="blue") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_M$walc,                                                       na.rm=TRUE),sd=sd(stdMath_M$walc, na.rm=TRUE)))
```
```{r wilcoxon test syntax}
# fmale group: Workday alcohol consumption and weekend alcohol consumption 
stats::wilcox.test(stdMath_F$dalc, stdMath_F$walc, paired=TRUE)
```

```{r wilcoxon test syntax}
# male group: Workday alcohol consumption and weekend alcohol consumption 
stats::wilcox.test(stdMath_M$dalc, stdMath_M$walc, paired=TRUE)
```

```{r wilcoxon test syntax}
coin::wilcox_test(dalc~as.factor(sex), data=stdMathData)
coin::wilcox_test(walc~as.factor(sex), data=stdMathData)

wilcoeffsize1 = rstatix::wilcox_effsize(dalc ~ sex, data=stdMathData)
wilcoeffsize1

wilcoeffsize2 = rstatix::wilcox_effsize(walc ~ sex, data=stdMathData)
wilcoeffsize2

```

```
Reporting the results for the Mann-Whitney test
For female students stdMath_F workday alchol consumption (Mdn=1.00, IQR=0.00) were significantly lower than weekend alchol consumption (Mdn=2.00, IQR=2.00), V = 79.50, p < .001. For male students stdMath_M, workday alchol consumption (Mdn=1.00, IQR=1.00) were lower than weekend alchol consumption (Mdn=3, IQR=3), V=72, p < .001.
```

### Non-Parametic test ---language course
```{r dalc and walc by sex repeat measure}
# get subset data by sex
variableint <- c("sex", "dalc", "walc")
stdPorlag_F <- subset(stdPorlagData, sex=="F")[variableint]
stdPorlag_M <- subset(stdPorlagData, sex=="M")[variableint]

# wilcoxon test should both sub samples are the same length
# randomly choose the data in the female sub-samples
#set.seed(2000)
#stdMath_F <- sample_n(stdMath_F, nrow(stdMath_M))

summary(stdPorlag_F)
pastecs::stat.desc(stdPorlag_F, basic=F)
summary(stdPorlag_M)
pastecs::stat.desc(stdPorlag_M, basic=F)

```

```{r dalc, walc}
# checking if the statistics dalc and walc are non parametic
# Workday alcohol consumption
ggplot(stdPorlag_F, aes(x=dalc)) +
      ggtitle ("Workday alcohol consumption")+ 
      labs(x="Workday alcohol consumption: Famle") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_F$dalc,                                                       na.rm=TRUE),sd=sd(stdMath_F$dalc, na.rm=TRUE)))

ggplot(stdPorlag_F, aes(x=walc)) +
      ggtitle ("Weekend alcohol consumption")+ 
      labs(x="Weekend alcohol consumption: Famle") + 
      geom_histogram(bins=5, colour="black") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_F$walc,                                                       na.rm=TRUE),sd=sd(stdMath_F$walc, na.rm=TRUE)))

# Weekend alcohol consumption
ggplot(stdPorlag_M, aes(x=dalc)) +
      ggtitle ("Workday alcohol consumption")+ 
      labs(x="Workday alcohol consumption: Male") + 
      geom_histogram(bins=5, colour="blue") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_M$dalc,                                                       na.rm=TRUE),sd=sd(stdMath_M$dalc, na.rm=TRUE)))

ggplot(stdPorlag_M, aes(x=walc)) +
      ggtitle ("Weekend alcohol consumption")+ 
      labs(x="Weekend alcohol consumption: Male") + 
      geom_histogram(bins=5, colour="blue") +
      scale_fill_gradient("Count", low="#DCDCDC", high="#7C7C7C") +
      stat_function(fun=dnorm, color="red",args=list(mean=mean(stdMath_M$walc,                                                       na.rm=TRUE),sd=sd(stdMath_M$walc, na.rm=TRUE)))
```
```{r wilcoxon test syntax}
# fmale group: Workday alcohol consumption and weekend alcohol consumption 
stats::wilcox.test(stdPorlag_F$dalc, stdPorlag_F$walc, paired=TRUE)
```

```{r wilcoxon test syntax}
# male group: Workday alcohol consumption and weekend alcohol consumption 
stats::wilcox.test(stdPorlag_M$dalc, stdPorlag_M$walc, paired=TRUE)
```

```{r}
stats::wilcox.test(stdPorlagData$dalc, stdPorlagData$walc, paired=TRUE)
```

```{r wilcoxon test syntax}
coin::wilcox_test(dalc~as.factor(sex), data=stdPorlagData)
coin::wilcox_test(walc~as.factor(sex), data=stdPorlagData)

wilcoeffsize1 = rstatix::wilcox_effsize(dalc ~ sex, data=stdPorlagData)
wilcoeffsize1

wilcoeffsize2 = rstatix::wilcox_effsize(walc ~ sex, data=stdPorlagData)
wilcoeffsize2

```

```
Reporting the results for the Mann-Whitney test
    For female students stdPorlagData_F workday alcohol consumption (Mdn=1.00, IQR=0.00) were significantly lower than weekend alcohol consumption (Mdn=2.00, IQR=2.00), V = 884.5, p < 0.001, r=0.28. 
   For male students stdPorlagData_M, workday alcohol consumption (Mdn=1.00, IQR=1.00) were lower than weekend alcohol consumption (Mdn=3, IQR=2), V=292, p < 0.001, r=0.30. 
     What's more, For workday alcohol consumption for both female and male students was significantly lower than weekend alcohol consumption for both female and male students(V = 2241.5, p-value < 0.001). 
```
#### Differences Nominal 
1. for two independent variables in Math course.
Sex - schoolup
Questioin: “Is there a difference between boys and girls in terms of whether they have extra educational support?”
H0:  There is no difference
HA: There is a difference

```{r Contingency table}
#CrossTable(predictor, outcome, fisher = TRUE, chisq = TRUE, expected = TRUE)
gmodels::CrossTable(stdMathData$sex, stdMathData$schoolsup, fisher = TRUE, chisq = TRUE, expected = TRUE, sresid = TRUE, format = "SPSS")
```
```{r}
# simplistic way of doing Chi-Square

#Create your contingency table
contintable<-xtabs(~schoolsup+sex, data=stdMathData)

ctest<-stats::chisq.test(contintable, correct=TRUE)#chi square test
#correct=TRUE to get Yates correction needed for 2x2 table

ctest#will give you the details of the test statistic and p-value

cat("\n ****************Expected frequencies:****************\n") 
ctest$expected#expected frequencies
cat("\n ****************Observed frequencies:****************\n") 
ctest$observed#observed frequencies
cat("\n *****p-value:Pearson's Chi-squared test with Yates' continuity correction *****\n") 
ctest$p.value
```
```{r effect size}
#Calculate effect size
sjstats::phi(contintable)
sjstats::cramer(contintable)
```
```
report Chi-Square Test for Independence

A Chi-Square test for independence (with Yates’ Continuity Correction) indicated significant association between gender and extra educational support, χ2(1,n=395)=2.30,p<0.01, phi=0.14).

```

### Difference for more than two groups 
#### Parametic
1. studytime weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours) group for final grade (g1)
```{r normality}
# g3 Examine/Asses Normality

gg_g1 <- ggplot(stdPorlagData, aes(x=g1)) +
         ggtitle("Figure 1 - Histogram for first period grade for Portuguese language course") + 
         labs(x="First period grade for Portuguese Language course") + 

#manage binwidth and colours
          geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..)) +
          scale_fill_gradient("Count") + 

#adding a normal curve
#use stat_function to compute a normalized score for each value of g1
#pass the mean and standard deviation
#use the na.rm parameter to say how missing values are handled
         stat_function(fun=dnorm, color="red",args=list(mean=mean(stdPorlagData$g1, na.rm=TRUE), sd=sd(stdPorlagData$g1, na.rm=TRUE)))

#to display the graph request the contents of the variable be shown
gg_g1
```
```{r qq plot for g3}
qqnorm(stdPorlagData$g1, main = "Figure 2 - QQ Plot for first period grade of Portuguese Language course")
qqline(stdPorlagData$g1, col = 2) # show a trend line on the plot.
```
```{r statistic description}
#summary(stdPorlagData)
pastecs::stat.desc(stdPorlagData$g1, basic=F)
```
```{r calculate skew and kurtosis for g3}
tpskew <- semTools::skew(stdPorlagData$g1)
tpkurt <- semTools::kurtosis(stdPorlagData$g1)
#skew calculate
tpskew[1]/tpskew[2]
#kurtosis calculate
tpkurt[1]/tpkurt[2]
```
```{r standarised scores}
# Calculate the percentage of standardized scores that are greated than 1.96
ztotsas <- abs(scale(stdPorlagData$g1))
FSA::perc(as.numeric(ztotsas), 1.96, "gt") # 'gt' = greater than 1.96, "leq" = equal, "lt"=less than
FSA::perc(as.numeric(ztotsas), 3.29, "gt")
```
```
Report assessment of normality for g1 (first period grade of Portuguese Language)

The first period grades of Portuguess Language course was assess for normality. Visual inspection of the histogram and QQ-Plot (refer Fig. 1 and Fig 2) identified some issues with skewness and kurtosis. The standardised score for skewness (-0.02884671) can be considered acceptable and the standarised score for kurtosis (0.1905247) was inside the accpetable range. Moreover more 99% of standarised scores for final grades fall within the bounds of +/- 3.29, the data can be considered to approximate a normal distribution (m=22.12, sd=2.75, n=649)

```

2. Differences more than 2 groups (ANOVA)
Describle first peroid grades by group (studytime: group1, group 2, group 3, and group 4)
```{r descriptive statistics by group}
psych::describeBy(stdPorlagData$g1, stdPorlagData$studytime, mat=TRUE)
```
```{r homogeneity check}
#conduct Bartlett's test for homogeneity of variance in library car
stats::bartlett.test(g1 ~ studytime, data=stdPorlagData)
```
``` {r Conduct one-way ANOVA}
#p-value is > 0.05 so the result is not statistically significant so we can assume homogeneity
userfriendlyscience::oneway(as.factor(stdPorlagData$studytime), y=stdPorlagData$g1, posthoc="Tukey")
```
```{r effect size and reporting}
# for reporting
res2<-stats::aov(g3 ~ studytime, data = stdPorlagData)
res2

summary(res2) #get F statistic and p-value

#Get the F statistic into a variable
fstat<-summary(res2)[[1]][["F value"]][[1]]
fstat
#Get the p value
aovpvalue<-summary(res2)[[1]][["Pr(>F)"]][[1]]
aovpvalue

#Calculate effect
aoveta<-sjstats::eta_sq(res2)[2]
aoveta
#In the report we are using the res2 variable to retrieve the degrees of freedom
#and the eta_sq function from the sjstats package to calculate the effect
```
```
Reporting the results with eta squared effect
An one-way between-groups analysis of variance (ANOVA) was conducted to explore the impact of weekly study time on the first period grades for Portuguese Langauge course. Participants were diveided into four groups according to their weekly study time (Group 1: < 2 hours; Group 2: 2 to 5 hours; Group 3: 5 to 10 hours; Group 4: > 10 hours). There was a statistically significant difference at the p < 0.001 level in first period grages for the four weekly study time groups: (F(3, 645) = 16.24), p<0.001.Despite reaching statistical significance, the actual difference in mean scores between groups was small. A small effect size was also indicated by the eta squared value (0.06). Post-hoc comparisions using the Tukey HSD test indicated that the mean scores for Group 1 (M=10.50, SD=2.57) was significantly difference to that for Group 2 (M=11.54, SD=2.74), Group 3 (M=12.42, SD=2.46), Group 4(M=12.77, SD=2.94); the mean scores for Group 2 was significantly difference to that for other three groups; Group 3 did not differ significantly for Group 4.
```

#### No Parametic
1. Kruskal-Wallis (Non-Parametric)
2. Friedmans ANOVA (non-parametric) for repeated measures

##### Kruska-wallis test
Nominal --- Guardian (student's guardian (mother, father or other))
Ordinal --- health (current health status (from 1 - very bad to 5 - very good))
group by guardian (3 groups)
```{r statistic descriptive}
psych::describeBy(as.numeric(stdPorlagData$health), factor(stdPorlagData$guardian),mat=TRUE)

```
``` {r kruskal - Wallis rank sum test}
#run a kruskal wallis test
stats::kruskal.test(health~guardian,data=stdPorlagData)
```
```{r post-hot test for between groups}
tmp_bonferroni<-FSA::dunnTest(x=as.numeric(stdPorlagData$health), g=factor(stdPorlagData$guardian), method="bonferroni") 
print(tmp_bonferroni, dunn.test.results = TRUE)
```
```{r effect size}
# bootstrapping
rstatix::kruskal_effsize(stdPorlagData, health~guardian, ci = FALSE, conf.level = 0.95, ci.type = "perc", nboot = 1000)
```
```
An Kruskal-Wallis rank sum was conducted to to explore the impact of guardian on levels of students health. Participants were divided into three groups according to their guardian (Group 1: Father; Group 2: Mother; Group 3: other). No statistically significant difference in the scores for the levels of health (Mdn=4.00, M=3.50, SD=1.42 for Group 1, Mdn= 4.00, M=3.54, SD=1.46 for Group 2, Mdn=4, M=3.59, SD=1.41 for Group 3) (H = 0.233, p=0.89). A very small effect size was also indicated by the kruskal value (-0.027e-102).
```


##### Friedmans ANOVA (non-parametric) for repeated measures
G1 G2 G3 for each students ranks

```{r }
Responses <- na.omit(with(stdPorlagData, cbind(g1, g2, g3)))
cat("\nMedians:\n") 
#print out the medians of each of our variables
print(apply(Responses, 2, median)) 
```
``` {r friedman test}
stats::friedman.test(Responses)
```
```
Report Firedman test

The three grades of participants for Portuguese Language course has strong significantly change over the three periods grades, χ2(2) = 6.75, p < 0.001.
```


